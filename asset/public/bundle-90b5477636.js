!function(e,t,i){var n=0;function o(e){return e.firstChild.innerHTML+e.lastChild.textContent}function l(){for(;this._container.firstChild;)this._container.removeChild(this._container.firstChild)}function s(e){null!=e&&(e.className=e.className.split(" ").filter(e=>!/ac__word--selected/.test(e)).join(" "))}e.Autocomplete=function(){n++;let e=this;e._id=n,e._input,e._idx,e._words,e._container,e._onSelectedCB=(()=>{}),e._config={delay:150,showWords:!0,hideOnblur:!0};let i=arguments[0];i&&"string"==typeof i?e._config.selector=i:i&&"object"==typeof i&&Object.keys(i).forEach(t=>{e._config[t]=i[t]}),e._words=[],e._idx=-1,e._keyListenerDebounced=function(e,t){let i=!0;return function(){i&&(i=!1,setTimeout(()=>{e.apply(null,Array.prototype.slice.apply(arguments)),i=!0},t))}}(function(e){var i=this,n=new XMLHttpRequest;n.open("GET","/omeka/s/bookshelf/search?query="+e,!0),n.onreadystatechange=function(){if(4==n.readyState){var e={};if(n.responseText&&(e=JSON.parse(n.responseText)),200==this.status&&i._config.showWords){var o=e.results.request_params.q,s=e.results.hits;(function(e,i){l.call(this),this._words=[];let n=t.createDocumentFragment();for(let e=0;e<i.length;e++){let o=t.createElement("p");o.className="ac__word",o.style.cursor="pointer";let l=t.createElement("span");l.style.pointerEvents="none",highlighted=i[e].highlights[0].snippet,highlighted=highlighted.replace(/<mark>/g,"<b>"),highlighted=highlighted.replace(/<\/mark>/g,"</b>"),highlighted=highlighted.trim(),l.innerHTML=highlighted,o.appendChild(l),n.appendChild(o),this._words.push(o)}this._container.appendChild(n)}).call(i,o,s)}}},n.send(null)}.bind(e),e._config.delay),e._input=t.querySelector(e._config.selector),null!=e._input&&(e._input.setAttribute("autocomplete","off"),e._config.showWords?(e._input.addEventListener("keyup",function(e){let t=e.keyCode||e.which,i=String.fromCharCode(t),n=this;if(38===t)n._idx>0&&(s(n._words[n._idx]),n._idx--),n._words[n._idx].className+=" ac__word--selected";else if(40==t)n._idx<n._words.length-1&&(s(n._words[n._idx]),n._idx++),n._words[n._idx].className+=" ac__word--selected";else if(13==t)n._words.length&&n._idx>-1?n._onSelectedCB(o(n._words[n._idx])):n._onSelectedCB(n._input.value);else if(/[a-zA-Z0-9-_ ]/.test(i)||8===t){n._idx=-1;let e=encodeURIComponent(n._input.value);""!=e?n._keyListenerDebounced(e):l.call(n)}}.bind(e),!1),function(){let e=t.createElement("div");e.className="ac__container",e.style.width=this._input.offsetWidth,this._input.parentNode.insertBefore(e,this._input.nextSibling);let i=t.createElement("div");i.className="ac__inner",i.style.position="absolute",i.style.top="100%",i.style.left=0,i.style.width="100%",e.appendChild(i),this._container=i}.call(e),function(){this._container.addEventListener("click",e=>{e.target!==e.currentTarget&&this._onSelectedCB(o(e.target)),e.stopPropagation()})}.call(e)):e._input.addEventListener("keyup",function(e){let t=e.keyCode||e.which,i=String.fromCharCode(t);if(13==t)this._onSelectedCB(this._input.value);else if(/[a-zA-Z0-9-_ ]/.test(i)||8===t){let e=encodeURIComponent(this._input.value);""!=e&&this._keyListenerDebounced(e)}}.bind(e),!1)),e._config.hideOnblur&&e._container.parentNode.classList.add("ac__container--hide-on-blur"),e._input.addEventListener("click",t=>{e._container.parentNode.style.display="block",t.AutocompleteClicked=!0})},e.addEventListener("load",function(){t.body.addEventListener("click",e=>{if(!e.AutocompleteClicked){let e=t.querySelectorAll(".ac__container--hide-on-blur");Array.prototype.slice.call(e).forEach(e=>e.style.display="none")}})}),Autocomplete.prototype.onSelectedWord=function(e){this._onSelectedCB=e},Autocomplete.prototype.onNewWords=function(e){this._onWordsCB=e}}(window,document),$(document).ready(function(){Autocomplete({selector:".search-text",delay:200})});